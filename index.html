<!DOCTYPE html>
<html>

<head>
    <title>screen defective pixels tester</title>
    <style>
        html,
        body {
            height: 100%;
            width: 100%;
            margin: 0;
            padding: 0;
        }

        svg {
            background-color: black;
        }

        pre#tips {
            position: fixed;
            top: 0;
            width: 100%;
            height: 100%;
            text-align: center;
            color: green;
        }
    </style>
</head>

<body>
    <svg id="main" width="100%" height="100%" preserveAspectRatio="none" viewBox="0, 0, 800, 450">
        <g id="testzone">
            <rect x="-10" y="-10" width="180" height="110" fill="#FFF">
                <animateMotion path="m0 0 h640 v90
                                     h-640 v90
                                      h640 v90
                                     h-640 v90
                                      h640 v90" begin="indefinite" dur="180s" repeatCount="indefinite" />
            </rect>
        </g>
    </svg>
    <pre id="tips">
        ========================== tips ===========================
        press Enter/ESC to get or exit full-screen model           
        press Space     to start or pause or continue test         
        press Shift     to toggle the background color in test zone
    </p>
    </pre>

    <script>
        const body = document.querySelector("body")
        const tips = document.querySelector("pre#tips")
        const svg = document.querySelector("svg#main")
        const testzone = document.querySelector("g#testzone > rect")
        const testzone_animate = document.querySelector("g#testzone > rect > animateMotion")

        const colors = ["#F00", "#0F0", "#00F", "#FF0", "#0FF", "#F0F", "#FFF"];
        const colors_generator = (function* () {
            while (true) {
                for (c of colors) {
                    yield c
                }
            }
        })()
        const color = () => colors_generator.next().value;

        // Common functions
        let testzone_animate_status = undefined;

        function toggleFullscreen() {
            if (document.fullscreenElement) {
                document.exitFullscreen();
            } else {
                body.requestFullscreen();
            }
        }

        function togglePlayPause() {
            switch (testzone_animate_status) {
                case 0:
                    svg.pauseAnimations();
                    testzone_animate_status = 1;
                    break;
                case 1:
                    svg.unpauseAnimations();
                    testzone_animate_status = 0;
                    break;
                case undefined:
                default:
                    tips.style.display = "none";
                    testzone_animate.beginElement();
                    testzone_animate_status = 0;
                    break;
            }
        }

        function changeColor() {
            testzone.style.fill = color();
        }

        // Keyboard event handler
        document.onkeydown = function (ev) {
            var e = ev || window.event;
            var key = e.which || e.keyCode || e.charCode;
            
            if (key == 13) { // Enter
                toggleFullscreen();
            } else if (key == 32) { // Space
                togglePlayPause();
            }
            
            if (e.shiftKey) { // Shift
                changeColor();
            }
        };

        // Touch event support
        let lastTapTime = 0;
        let touchStartDistance = 0;
        let isPinching = false;

        // Single tap - change color (Shift)
        body.addEventListener('click', function(e) {
            // Prevent single click on double click
            if (new Date().getTime() - lastTapTime > 300) {
                changeColor();
            }
        });

        // Double tap - play/pause (Space)
        body.addEventListener('dblclick', function(e) {
            e.preventDefault();
            togglePlayPause();
        });

        // Pinch gesture for fullscreen (Enter)
        body.addEventListener('touchstart', function(e) {
            lastTapTime = new Date().getTime();
            
            if (e.touches.length === 2) {
                isPinching = true;
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                touchStartDistance = Math.sqrt(dx * dx + dy * dy);
            }
        });

        body.addEventListener('touchmove', function(e) {
            if (isPinching && e.touches.length === 2) {
                e.preventDefault();
                const dx = e.touches[0].clientX - e.touches[1].clientX;
                const dy = e.touches[0].clientY - e.touches[1].clientY;
                const currentDistance = Math.sqrt(dx * dx + dy * dy);
                
                // Detect pinch gesture (distance change > 50px)
                if (Math.abs(currentDistance - touchStartDistance) > 50) {
                    toggleFullscreen();
                    isPinching = false; // Prevent repeated triggers
                }
            }
        });

        body.addEventListener('touchend', function(e) {
            if (e.touches.length < 2) {
                isPinching = false;
            }
        });
    </script>
</body>

</html>